  # ğŸ—ï¸ Solar Energy Trading Platform - Complete Architecture

## ğŸ“Š System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT LAYER                                        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Web Browser   â”‚  â”‚  Mobile App     â”‚  â”‚   API Client    â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚  â€¢ HTML5/CSS3   â”‚  â”‚  â€¢ React Native â”‚  â”‚  â€¢ Python       â”‚             â”‚
â”‚  â”‚  â€¢ JavaScript   â”‚  â”‚  â€¢ Flutter      â”‚  â”‚  â€¢ cURL         â”‚             â”‚
â”‚  â”‚  â€¢ Chart.js     â”‚  â”‚                 â”‚  â”‚  â€¢ Postman      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                    â”‚                     â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    HTTP/REST + WebSocket (Socket.IO)
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APPLICATION LAYER                                     â”‚
â”‚                          app_backend.py                                       â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Flask Application                              â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  Framework: Flask 3.0.0                                                â”‚  â”‚
â”‚  â”‚  Extension: Flask-SocketIO 5.3.5 (async_mode='threading')             â”‚  â”‚
â”‚  â”‚  Extension: Flask-CORS 4.0.0                                           â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                    REST API Endpoints                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Solar Forecasting:                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ POST /api/solar/forecast                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Generate power forecast (6-72h, customizable interval)   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ POST /api/solar/building-potential                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Calculate rooftop solar potential                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /api/solar/dashboard                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Comprehensive dashboard data (24h forecast + stats)      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /api/solar/plant-info                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Plant configuration and model status                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Energy Trading:                                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ POST /wallet                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Create quantum-enabled trading wallet                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /wallet/<user_id>                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Retrieve wallet information                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ POST /order                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Place buy/sell energy order                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /book                                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Get current order book (top 20 bids/asks)                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /book/summary                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Order book statistics                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Blockchain:                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /chain                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Recent blocks (last 10)                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /chain/full                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Complete blockchain with validation                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ POST /quantum/channel                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Establish quantum communication channel                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /quantum/participants                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> List all quantum participants                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /stats                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Platform-wide statistics                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GET  /health                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Health check endpoint                                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                  WebSocket Events                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ connect                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Send initial state (order book + forecast)               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ disconnect                                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Clean up client connection                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ request_forecast                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Generate and emit forecast on demand                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ market_update (broadcast)                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Real-time order book and trade updates (300ms)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ forecast_update (emit)                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€> Push forecast results to client                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       FORECASTING SERVICE            â”‚  â”‚     TRADING ENGINE                  â”‚
â”‚       solar_service.py               â”‚  â”‚     background_order_processor.py   â”‚
â”‚                                      â”‚  â”‚                                     â”‚
â”‚  Class: SolarForecastService         â”‚  â”‚  Components:                        â”‚
â”‚                                      â”‚  â”‚  â€¢ Order Queue (deque)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â€¢ Order Book (dict)                â”‚
â”‚  â”‚  Model Management              â”‚ â”‚  â”‚    - bids: list[(price, qty, ts)]  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚    - asks: list[(price, qty, ts)]  â”‚
â”‚  â”‚  â€¢ Load trained models         â”‚ â”‚  â”‚  â€¢ State Lock (threading.Lock)      â”‚
â”‚  â”‚    - plant_1_quantile_10.pkl   â”‚ â”‚  â”‚  â€¢ Blockchain reference             â”‚
â”‚  â”‚    - plant_1_quantile_50.pkl   â”‚ â”‚  â”‚  â€¢ SocketIO reference               â”‚
â”‚  â”‚    - plant_1_quantile_90.pkl   â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚  â€¢ Model format: LGBMRegressor â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ Quantiles: 0.1, 0.5, 0.9    â”‚ â”‚  â”‚  â”‚  Order Processing Loop       â”‚  â”‚
â”‚  â”‚  â€¢ Load via joblib             â”‚ â”‚  â”‚  â”‚  (300ms cycle)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚                                      â”‚  â”‚  â”‚  1. Drain order queue        â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  2. Rank orders              â”‚  â”‚
â”‚  â”‚  Forecast Generation           â”‚ â”‚  â”‚  â”‚     - Bids: price DESC       â”‚  â”‚
â”‚  â”‚  Method: generate_forecast()   â”‚ â”‚  â”‚  â”‚     - Asks: price ASC        â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  3. Match orders             â”‚  â”‚
â”‚  â”‚  Inputs:                       â”‚ â”‚  â”‚  â”‚     - Best bid >= best ask   â”‚  â”‚
â”‚  â”‚  â€¢ start_time (optional)       â”‚ â”‚  â”‚  â”‚  4. Create transaction       â”‚  â”‚
â”‚  â”‚  â€¢ hours (6-72)                â”‚ â”‚  â”‚  â”‚     - Standard or Quantum    â”‚  â”‚
â”‚  â”‚  â€¢ interval_minutes (5-60)     â”‚ â”‚  â”‚  â”‚  5. Update order book        â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  6. Broadcast via WebSocket  â”‚  â”‚
â”‚  â”‚  Process:                      â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  1. Create time index          â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚  2. Generate clear-sky (PVLib) â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  3. Calculate p_clear          â”‚ â”‚  â”‚  â”‚  Order Matching Logic        â”‚  â”‚
â”‚  â”‚  4. Build dataframe            â”‚ â”‚  â”‚  â”‚  order_book.py               â”‚  â”‚
â”‚  â”‚  5. Apply FeatureBuilder       â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  6. Predict residuals          â”‚ â”‚  â”‚  â”‚  Algorithm:                  â”‚  â”‚
â”‚  â”‚  7. Calculate power            â”‚ â”‚  â”‚  â”‚  â€¢ Price-time priority       â”‚  â”‚
â”‚  â”‚  8. Compute statistics         â”‚ â”‚  â”‚  â”‚  â€¢ Liquidity assessment      â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚    - Volume threshold        â”‚  â”‚
â”‚  â”‚  Formula:                      â”‚ â”‚  â”‚  â”‚    - Spread threshold        â”‚  â”‚
â”‚  â”‚  power = p_clear + residual    â”‚ â”‚  â”‚  â”‚  â€¢ Partial fills allowed     â”‚  â”‚
â”‚  â”‚  (clipped to [0, capacity])    â”‚ â”‚  â”‚  â”‚  â€¢ Transaction price = ask   â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  Output:                       â”‚ â”‚  â”‚  â”‚  Data Structures:            â”‚  â”‚
â”‚  â”‚  â€¢ timestamps[]                â”‚ â”‚  â”‚  â”‚  â€¢ transacted_orders[]       â”‚  â”‚
â”‚  â”‚  â€¢ forecasts{p10, p50, p90}    â”‚ â”‚  â”‚  â”‚    - (timestamp, price, qty) â”‚  â”‚
â”‚  â”‚  â€¢ clearsky_baseline[]         â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ statistics{}                â”‚ â”‚  â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                      â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚
â”‚  â”‚  Feature Engineering           â”‚ â”‚                    â”‚
â”‚  â”‚  Uses: YOUR FeatureBuilder     â”‚ â”‚                    â–¼
â”‚  â”‚  Module: features.py           â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚                                â”‚ â”‚  â”‚     BLOCKCHAIN SYSTEM               â”‚
â”‚  â”‚  Lag Steps: [1,2,3,4,6,12,24] â”‚ â”‚  â”‚     block_chain_templates.py        â”‚
â”‚  â”‚  Rolling Window: 4             â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  Class: Blockchain                  â”‚
â”‚  â”‚  Features Created:             â”‚ â”‚  â”‚  Difficulty: 2 (configurable)       â”‚
â”‚  â”‚  â€¢ Time: sin/cos hour, doy     â”‚ â”‚  â”‚  Max Transactions/Block: 5          â”‚
â”‚  â”‚  â€¢ Weather: irrad, temp, wind  â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚  â€¢ Clear-sky: p_clear, ghi     â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ Lags: power_w, residual     â”‚ â”‚  â”‚  â”‚  Block Structure             â”‚  â”‚
â”‚  â”‚  â€¢ Rolling: mean, std          â”‚ â”‚  â”‚  â”‚  Class: Block                â”‚  â”‚
â”‚  â”‚  â€¢ Weekend flag                â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  â€¢ index: int                â”‚  â”‚
â”‚  â”‚  Output Shape:                 â”‚ â”‚  â”‚  â”‚  â€¢ transactions: List[Tx]    â”‚  â”‚
â”‚  â”‚  (n_samples, ~40-60 features)  â”‚ â”‚  â”‚  â”‚  â€¢ timestamp: float          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â€¢ previous_hash: str        â”‚  â”‚
â”‚                                      â”‚  â”‚  â”‚  â€¢ nonce: int                â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â€¢ merkle_root: str          â”‚  â”‚
â”‚  â”‚  Carbon Calculations           â”‚ â”‚  â”‚  â”‚  â€¢ hash: str (SHA-256)       â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  Emission Factor:              â”‚ â”‚  â”‚  â”‚  Hash includes:              â”‚  â”‚
â”‚  â”‚  â€¢ 0.417 kg COâ‚‚/kWh            â”‚ â”‚  â”‚  â”‚  - index                     â”‚  â”‚
â”‚  â”‚    (grid displacement)         â”‚ â”‚  â”‚  â”‚  - merkle_root               â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  - timestamp                 â”‚  â”‚
â”‚  â”‚  Calculations:                 â”‚ â”‚  â”‚  â”‚  - previous_hash             â”‚  â”‚
â”‚  â”‚  â€¢ Total COâ‚‚ saved (kg)        â”‚ â”‚  â”‚  â”‚  - nonce                     â”‚  â”‚
â”‚  â”‚  â€¢ COâ‚‚ saved (tons)            â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ Tree equivalency            â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚    (21 kg COâ‚‚/tree/year)       â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ Daily/Monthly breakdown     â”‚ â”‚  â”‚  â”‚  Transaction Structure       â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Class: Transaction          â”‚  â”‚
â”‚  â”‚  Building Potential:           â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Max panels from roof area   â”‚ â”‚  â”‚  â”‚  â€¢ sender: str               â”‚  â”‚
â”‚  â”‚  â€¢ Total capacity (kW)         â”‚ â”‚  â”‚  â”‚  â€¢ recipient: str            â”‚  â”‚
â”‚  â”‚  â€¢ Annual energy (kWh)         â”‚ â”‚  â”‚  â”‚  â€¢ amount: float             â”‚  â”‚
â”‚  â”‚  â€¢ Environmental impact        â”‚ â”‚  â”‚  â”‚  â€¢ signature: bytes          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â€¢ timestamp: float          â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â€¢ quantum_payload: dict     â”‚  â”‚
                                          â”‚  â”‚    (optional)                â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                              â”‚  â”‚
â”‚     MACHINE LEARNING MODELS          â”‚  â”‚  â”‚  Signature:                  â”‚  â”‚
â”‚     model.py                         â”‚  â”‚  â”‚  â€¢ HMAC-SHA256               â”‚  â”‚
â”‚                                      â”‚  â”‚  â”‚  â€¢ Signs transaction dict    â”‚  â”‚
â”‚     Class: QuantileRegressor         â”‚  â”‚  â”‚  â€¢ Verifiable with key       â”‚  â”‚
â”‚                                      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                     â”‚
â”‚  â”‚  Model Architecture            â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Proof of Work               â”‚  â”‚
â”‚  â”‚  Base: LightGBM                â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Objective: quantile         â”‚ â”‚  â”‚  â”‚  Algorithm:                  â”‚  â”‚
â”‚  â”‚  â€¢ n_estimators: 400           â”‚ â”‚  â”‚  â”‚  â€¢ Hash block repeatedly     â”‚  â”‚
â”‚  â”‚  â€¢ learning_rate: 0.05         â”‚ â”‚  â”‚  â”‚  â€¢ Increment nonce           â”‚  â”‚
â”‚  â”‚  â€¢ num_leaves: 64              â”‚ â”‚  â”‚  â”‚  â€¢ Check if hash starts with â”‚  â”‚
â”‚  â”‚  â€¢ subsample: 0.8              â”‚ â”‚  â”‚  â”‚    '00...' (difficulty)      â”‚  â”‚
â”‚  â”‚  â€¢ colsample_bytree: 0.8       â”‚ â”‚  â”‚  â”‚  â€¢ Continue until valid      â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  Training:                     â”‚ â”‚  â”‚  â”‚  Complexity: O(2^difficulty) â”‚  â”‚
â”‚  â”‚  â€¢ Time-series CV (3 folds)    â”‚ â”‚  â”‚  â”‚  Difficulty 2: ~100-1000     â”‚  â”‚
â”‚  â”‚  â€¢ Separate model per quantile â”‚ â”‚  â”‚  â”‚    hash attempts             â”‚  â”‚
â”‚  â”‚  â€¢ Early stopping              â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ No data leakage             â”‚ â”‚  â”‚                                     â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Prediction:                   â”‚ â”‚  â”‚  â”‚  Merkle Tree                 â”‚  â”‚
â”‚  â”‚  â€¢ Input: feature matrix       â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Output: residual values     â”‚ â”‚  â”‚  â”‚  Structure:                  â”‚  â”‚
â”‚  â”‚  â€¢ 3 quantiles: P10, P50, P90  â”‚ â”‚  â”‚  â”‚  â€¢ Leaf: SHA256(tx)          â”‚  â”‚
â”‚  â”‚  â€¢ NOT direct power!           â”‚ â”‚  â”‚  â”‚  â€¢ Node: SHA256(L + R)       â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  â€¢ Root: Top hash            â”‚  â”‚
â”‚  â”‚  Saved Format:                 â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Pickle (.pkl) via joblib    â”‚ â”‚  â”‚  â”‚  Purpose:                    â”‚  â”‚
â”‚  â”‚  â€¢ One file per quantile       â”‚ â”‚  â”‚  â”‚  â€¢ Efficient verification    â”‚  â”‚
â”‚  â”‚  â€¢ ~5-10 MB each               â”‚ â”‚  â”‚  â”‚  â€¢ Tamper detection          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â€¢ Integrity proof           â”‚  â”‚
â”‚                                      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                     â”‚
â”‚  â”‚  Validation Metrics            â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Quantum Enhancements        â”‚  â”‚
â”‚  â”‚  Per Quantile:                 â”‚ â”‚  â”‚  â”‚  Classes:                    â”‚  â”‚
â”‚  â”‚  â€¢ MAE (Mean Absolute Error)   â”‚ â”‚  â”‚  â”‚  â€¢ QuantumParticipant        â”‚  â”‚
â”‚  â”‚  â€¢ NMAE (Normalized MAE)       â”‚ â”‚  â”‚  â”‚  â€¢ QuantumHybridChannel      â”‚  â”‚
â”‚  â”‚  â€¢ Coverage (P10-P90 interval) â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Features:                   â”‚  â”‚
â”‚  â”‚  Typical Performance:          â”‚ â”‚  â”‚  â”‚  â€¢ Quantum key distribution  â”‚  â”‚
â”‚  â”‚  â€¢ NMAE: 5-15% of capacity     â”‚ â”‚  â”‚  â”‚  â€¢ Session key (SHA256)      â”‚  â”‚
â”‚  â”‚  â€¢ Coverage: 80-90%            â”‚ â”‚  â”‚  â”‚  â€¢ XOR stream cipher         â”‚  â”‚
â”‚  â”‚  â€¢ Training time: 2-5 min      â”‚ â”‚  â”‚  â”‚  â€¢ Integrity checking        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â€¢ Secure channels           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                              â”‚  â”‚
                                          â”‚  â”‚  Purpose:                    â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â€¢ Enhanced security         â”‚  â”‚
â”‚     SOLAR CALCULATIONS               â”‚  â”‚  â”‚  â€¢ Quantum-resistant crypto  â”‚  â”‚
â”‚     PVLib Python 0.10.3              â”‚  â”‚  â”‚  â€¢ Private transactions      â”‚  â”‚
â”‚                                      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                     â”‚
â”‚  â”‚  Clear-Sky Modeling            â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Blockchain Operations       â”‚  â”‚
â”‚  â”‚  Location Class:               â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Latitude, Longitude         â”‚ â”‚  â”‚  â”‚  â€¢ add_transaction()         â”‚  â”‚
â”‚  â”‚  â€¢ Timezone                    â”‚ â”‚  â”‚  â”‚    - Validate signature      â”‚  â”‚
â”‚  â”‚  â€¢ Altitude (optional)         â”‚ â”‚  â”‚  â”‚    - Add to mempool          â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚    - Mine if threshold met   â”‚  â”‚
â”‚  â”‚  Solar Position:               â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Zenith angle                â”‚ â”‚  â”‚  â”‚  â€¢ mine_pending_transactions â”‚  â”‚
â”‚  â”‚  â€¢ Azimuth angle               â”‚ â”‚  â”‚  â”‚    - Collect from mempool    â”‚  â”‚
â”‚  â”‚  â€¢ Elevation                   â”‚ â”‚  â”‚  â”‚    - Add mining reward       â”‚  â”‚
â”‚  â”‚  â€¢ Air mass                    â”‚ â”‚  â”‚  â”‚    - Proof of work           â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚    - Append to chain         â”‚  â”‚
â”‚  â”‚  Ineichen Model:               â”‚ â”‚  â”‚  â”‚    - Broadcast               â”‚  â”‚
â”‚  â”‚  â€¢ Direct Normal Irradiance    â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  â€¢ Diffuse Horizontal Irrad.   â”‚ â”‚  â”‚  â”‚  â€¢ is_chain_valid()          â”‚  â”‚
â”‚  â”‚  â€¢ Global Horizontal Irrad.    â”‚ â”‚  â”‚  â”‚    - Verify all hashes       â”‚  â”‚
â”‚  â”‚  â€¢ Accounts for:               â”‚ â”‚  â”‚  â”‚    - Check linkage           â”‚  â”‚
â”‚  â”‚    - Atmospheric turbidity     â”‚ â”‚  â”‚  â”‚    - Validate PoW            â”‚  â”‚
â”‚  â”‚    - Precipitable water        â”‚ â”‚  â”‚  â”‚    - Verify signatures       â”‚  â”‚
â”‚  â”‚    - Altitude effects          â”‚ â”‚  â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚                                â”‚ â”‚  â”‚  â”‚  Storage:                    â”‚  â”‚
â”‚  â”‚  Output:                       â”‚ â”‚  â”‚  â”‚  â€¢ In-memory chain list      â”‚  â”‚
â”‚  â”‚  â€¢ GHI, DNI, DHI (W/mÂ²)        â”‚ â”‚  â”‚  â”‚  â€¢ Pickle serialization      â”‚  â”‚
â”‚  â”‚  â€¢ Used to calculate p_clear   â”‚ â”‚  â”‚  â”‚  â€¢ File persistence optional â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚     DATA PERSISTENCE             â”‚
                                â”‚                                  â”‚
                                â”‚  Trained Models:                 â”‚
                                â”‚  â€¢ artifacts/models/*.pkl        â”‚
                                â”‚  â€¢ LightGBM binary format        â”‚
                                â”‚  â€¢ Joblib serialization          â”‚
                                â”‚                                  â”‚
                                â”‚  Configuration:                  â”‚
                                â”‚  â€¢ Python dataclasses            â”‚
                                â”‚  â€¢ Runtime configuration         â”‚
                                â”‚  â€¢ No database required          â”‚
                                â”‚                                  â”‚
                                â”‚  Blockchain:                     â”‚
                                â”‚  â€¢ In-memory chain               â”‚
                                â”‚  â€¢ Optional file persistence     â”‚
                                â”‚  â€¢ Pickle format                 â”‚
                                â”‚                                  â”‚
                                â”‚  Order Book:                     â”‚
                                â”‚  â€¢ In-memory lists               â”‚
                                â”‚  â€¢ Thread-safe (Lock)            â”‚
                                â”‚  â€¢ Volatile (resets on restart)  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

